<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pagamento</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-xl bg-white shadow-xl rounded-xl p-8 border border-gray-200 space-y-8">
    <h1 class="text-3xl font-bold text-gray-800 text-center">Pagamento</h1>

    <!-- Seção PIX -->
    <section>
      {% if status_pagamento == "sucesso" %}
        <div class="bg-green-100 text-green-800 p-4 rounded mb-4 text-center">
          ✅ Pagamento criado com sucesso!<br>
          ID: <strong>{{ payment_id }}</strong><br>
          Chave PIX: <span class="font-mono">{{ chave_pix }}</span>
        </div>

        <form action="/pagamento" method="GET" class="mt-4">
          <button type="submit"
                  class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 rounded transition">
            Novo Pagamento
          </button>
        </form>
      {% elif status_pagamento == "erro" %}
        <div class="bg-red-100 text-red-800 p-4 rounded mb-4 text-center">
          ❌ Ocorreu um erro ao criar o pagamento. Tente novamente.
        </div>
      {% endif %}

      <h2 class="text-xl font-semibold text-gray-700 mb-2">Pagamento via PIX</h2>
      <p class="text-sm text-gray-600 mb-4">Escaneie o QR Code ou copie a chave abaixo.</p>

      {% if qr_code_base64 %}
        <div class="flex justify-center mb-4">
          <img src="data:image/png;base64,{{ qr_code_base64 }}" alt="QR Code PIX" class="w-48 h-48" />
        </div>
      {% else %}
        <div class="qr-placeholder mb-4">QR CODE AQUI</div>
      {% endif %}

      <p class="text-sm text-gray-600 text-center mb-4">Valor: R$ {{ valor_pix | default("50.00") }}</p>

      <div class="mb-4">
        <label for="pix_code" class="block text-sm font-medium text-gray-700 mb-1">Chave Copia e Cola</label>
        <input id="pix_code" type="text" readonly
               value="{{ chave_pix | default('00020126330014BR.GOV.BCB.PIX01111234567890') }}"
               class="w-full px-4 py-3 border border-gray-300 rounded bg-gray-100 text-sm font-mono" />
        <button onclick="copyPixCode()" type="button"
                class="mt-2 w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded transition">
          Copiar Chave PIX
        </button>
      </div>

      {% if payment_id %}
        <form action="/verificar_pagamento" method="GET" class="mb-2">
          <input type="hidden" name="payment_id" value="{{ payment_id }}">
          <button type="submit"
                  class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded transition">
            Já Paguei (Verificar Status)
          </button>
        </form>

        <form action="/simular_pagamento" method="POST">
          <input type="hidden" name="payment_id" value="{{ payment_id }}">
          <button type="submit"
                  class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 rounded transition">
            Simular Pagamento Aprovado (Sandbox)
          </button>
        </form>
      {% else %}
        <form action="pagamento" method="POST">
          <label for="valor" class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
          <input type="number" step="0.01" name="valor" id="valor"
                 value="{{ valor_pix | default('20.00') }}"
                 class="w-full px-4 py-3 border border-gray-300 rounded bg-white text-sm mb-3" required />
          <button type="submit"
                  class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded transition">
            Gerar QR Code
          </button>
        </form>
      {% endif %}
    </section>

    <!-- Status do pagamento -->
    {% if status_pagamento %}
      <div class="p-4 rounded-lg text-center {% if status_pagamento == 'approved' %}bg-green-100 text-green-800{% elif status_pagamento == 'pending' %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">
        Status do pagamento: <strong>{{ status_pagamento }}</strong>
      </div>
    {% endif %}
  </div>

  <script>
    function copyPixCode() {
      const pixInput = document.getElementById("pix_code");
      pixInput.select();
      pixInput.setSelectionRange(0, 99999);
      try {
        document.execCommand("copy");
        alert("Chave PIX copiada!");
      } catch (err) {
        alert("Erro ao copiar a chave.");
      }
    }
  </script>
</body>
</html>